name: Asana Sync

on:
  pull_request:
    types: [opened, edited, closed]

jobs:
  sync:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v6

      - name: Sync PR to Asana
        uses: ./
        with:
          asana_token: ${{ secrets.ASANA_TOKEN }}
          github_token: ${{ github.token }}
          integration_secret: ${{ secrets.ASANA_INTEGRATION_SECRET }}
          rules: |
            rules:
              # When PR opens or reopens → Set to "In Review" and attach PR
              - when:
                  event: pull_request
                  action: [opened, reopened]
                  draft: false
                then:
                  attach_pr_to_tasks: true
                  update_fields:
                    '1202887490284881': '1202887490288021'  # Status → "In Review"

              # When PR is edited (e.g., Asana link added) → Set to "In Review" and attach PR
              - when:
                  event: pull_request
                  action: edited
                  draft: false
                then:
                  attach_pr_to_tasks: true
                  update_fields:
                    '1202887490284881': '1202887490288021'  # Status → "In Review"

              # When draft PR is marked ready for review → Set to "In Review" and attach PR
              - when:
                  event: pull_request
                  action: ready_for_review
                then:
                  attach_pr_to_tasks: true
                  update_fields:
                    '1202887490284881': '1202887490288021'  # Status → "In Review"

              # When PR merges → Set to "Ready"
              - when:
                  event: pull_request
                  action: closed
                  merged: true
                then:
                  update_fields:
                    '1202887490284881': '1202887556915715'  # Status → "Ready"
